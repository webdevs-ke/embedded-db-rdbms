<div class="sql-console">
    <h2>SQL Console</h2>
    <textarea [formControl]="sql" rows="10" cols="60" placeholder="Enter SQL:"></textarea>
    <div class="console-btns">
        <button (click)="run()" [disabled]="sql.invalid || showHistory">RUN</button>
        <button (click)="clear()" [disabled]="!sql.value">CLEAR</button>
        <button (click)="toggleHistory()" [disabled]="!history.length">HISTORY</button>
    </div>
    <pre>{{output | json}}</pre>    
    
    @if (output?.type === "TABLE_SCHEMA") {
        <div class="output-content">
            <h3>Table: {{ output.table }}</h3>      
            <table>
              <thead>
                <tr>
                  <th>Column</th>
                  <th>Type</th>
                  <th>Primary</th>
                  <th>Unique</th>
                </tr>
              </thead>
              <tbody>
                @for (c of output.columns; track c.name) {
                    <tr>
                      <td>{{ c.name }}</td>
                      <td>{{ c.type }}</td>
                      <td>{{ c.primary }}</td>
                      <td>{{ c.unique }}</td>
                    </tr>
                }            
              </tbody>
            </table>
        </div>      
    }
    
    @if (output?.type === 'TABLE_DATA') {
        <div>
            <h3>Table: {{ output.table }}</h3>
            @if (output.rows.length) {
                <table>
                    <thead>
                      <tr>
                        @for (key of output.rows[0] | keyvalue; track key) {
                            <th>
                                {{ key.key }}
                            </th>
                        }                    
                      </tr>
                    </thead>            
                    <tbody>
                        @for (row of output.rows; track row) {
                            <tr>
                                @for (cell of row | keyvalue; track cell) {
                                    <td>
                                        {{ cell.value }}
                                    </td>
                                }                            
                            </tr>
                        }                  
                    </tbody>
                </table>
            }
            @if (!output.rows.length) {
                <p>Table is empty</p>
            }        
        </div>      
    }
    
    @if (output?.error) {
        <div class="error">
            {{ output.error }}
        </div>
    }    

    @if (showHistory) {
        <div class="history">
          <h3>Query History</h3>
      
          @if (history.length) {
            <ul>
              @for (q of history; track q) {
                <li>
                  <button type="button" (click)="loadFromHistory(q)">
                    {{ q }}
                  </button>
                </li>
              }
            </ul>
          }
        </div>
      }
</div>